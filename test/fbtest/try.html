<!DOCTYPE html>
<html>
<head>
<title>Facebook Login JavaScript Example</title>
<meta charset="UTF-8">
<meta name="viewport" content="initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<style>
     iframe {
        width: 1px;
        min-width: 100%;
        *width: 100%;
    }
</style>

<style>

.modal{
  padding: 0 !important;
}

.modal-dialog {
  width: 100%;
  height: 100%;
  padding: 0;
  margin: 0;
}

.modal-dialog {
  width: auto;
  height: auto;
  margin: 0;
}

.modal-content {
  height: 100%;
  border-radius: 0;
}

.modal-content {
  height: auto;
  min-height: 100%;
}


.signInIframe {
  min-height: 645px;
}



#frameContainer{
  margin:0;
  padding:0;
  position: relative;
}

button.close{
  position: absolute;
  right: 30px;
  margin: 0;
  padding: 0;
  top: 0;
  opacity: 0.5;
  font-weight: 400;
  font-size: 50px;

  /*
  background: 0 none;
  float: none;
  line-height: 0;

  */
}

</style>
</head>
<body>


<h1>CN TRAVELER</h1>

<button onclick="s()">leave a note!</button>


<div id="status">?</div>

<!--CNID Modal-->
    <div id="myModal" class="modal fade cnid-modal" tabindex="-1" role="dialog" aria-labelledby="cnid-modalLabel" aria-hidden="true">
        <div class="modal-dialog cnid-modal-dialog">
            <div class="modal-content cnid-modal-content">
                <div id="frameContainer" class="modal-body cnid-modal-body cnid-ios-scroll">
                    <button type="button" class="close cnid-close" data-dismiss="modal" aria-hidden="true">x</button>
                    <iframe id="cnidClient" src="fbtesto.html" class="cnid-signin-iframe" frameborder="0" marginheight="0" marginwidth="0" height="100%" width="100%"></iframe>
                    <!-- loader overlay 
                    <div id="loader-container">
                        <div class="cnid-overlay-bg"></div>
                        <div class="cnid-loader">
                          <img src="https://cnid.condenastdigital.com/client/assets/img/spinner.gif">
                        </div>
                    </div>-->
                    <!-- alerts overlay -->
                    <div id="alerts-container" class="hide">
                        <div class="cnid-overlay-bg"></div>
                        <div id="alert-message" class="cnid-alert-message alert text-center alert-success">
                          <p id="alert-txt"></p>
                          <button id="okay-btn" type="button" class="btn btn-form cnid-btn">Okay</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>

<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script>
// Load the SDK asynchronously
(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>


<script>
var test = (function () {
    function login() {
      try {
        FB.login(function (response) {
          if (response.authResponse) {
            redirect();
          } else {
            document.getElementById('status').innerHTML = 'user has cancelled the login!';
          }
        });
      } catch (err) {
        alert(err);
        alert(err.message);
      }
    }
    function statusChangeCallback(response) {
          console.log('statusChangeCallback');
          //  console.info(response);
          
          
      // The response object is returned with a status field that lets the
      // app know the current login status of the person.
      // Full docs on the response object can be found in the documentation
      // for FB.getLoginStatus().
      if (response.status === 'connected') {
     document.getElementById('status').innerHTML = 'Status:' + response.status;      
        redirect();
      } else if (response.status === 'not_authorized') {
        document.getElementById('status').innerHTML = 'Please log into this app |  Status:' + response.status;
        login();
      } else {
        // The person is not logged into Facebook, so we're not sure if
        // they are logged into this app or not.
        document.getElementById('status').innerHTML = 'Please log into facebook |  Status:' + response.status;
        login();
      }
    }
    function checkLoginState() {
      FB.getLoginStatus(function (response) {
        statusChangeCallback(response);
      }, true);
    }
    function redirect() {
      openModal();
    }
    return {
      checkLoginState: checkLoginState
    };
  }) ();
</script>

<script>
  window.fbAsyncInit = function() {
    FB.init({
        // appId      : '1488704804758806',
        appId: '1670352679887073',

        cookie: true, // enable cookies to allow the server to access the session
        //xfbml: true, // parse social plugins on this page
        xfbml: false,
        version: 'v2.2', // use version 2.2
        oauth      : true,
        status: true
    });



    // Now that we've initialized the JavaScript SDK, we call 
    // FB.getLoginStatus().  This function gets the state of the
    // person visiting this page and can return one of three states to
    // the callback you provide.  They can be:
    //
    // 1. Logged into your app ('connected')
    // 2. Logged into Facebook, but not your app ('not_authorized')
    // 3. Not logged into Facebook and can't tell if they are logged into
    //    your app or not.
    //fb
    // These three cases are handled in the callback function.

   FB.getLoginStatus(function(response) {
        console.warn(response.status);
        
   }, true);
    
//    test.checkLoginState();

};

</script>






<script>

function isFacebookApp() {
    var ua = navigator.userAgent || navigator.vendor || window.opera;
    return (ua.indexOf("FBAN") > -1) || (ua.indexOf("FBAV") > -1);
}


function openModal(){
  $("#myModal").modal();
}


function s(){
    if(!isFacebookApp()){
        openModal();
    } else {
        testLogin();
    }
    
}




function testLogin() {
  test.checkLoginState();
}
    


</script>


</body>
</html>
